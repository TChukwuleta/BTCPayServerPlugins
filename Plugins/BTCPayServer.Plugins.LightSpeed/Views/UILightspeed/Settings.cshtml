@using BTCPayServer.Abstractions.Contracts
@using BTCPayServer.Plugins.LightSpeed.ViewModels
@inject IScopeProvider ScopeProvider
@model LightspeedSettingsViewModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Lightspeed HQ";
    var storeId = ScopeProvider.GetCurrentStoreId();
}

<form method="post">
    <div class="sticky-header">
        <h2 text-translate="true">@ViewData["Title"]</h2>
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary">Save Settings</button>
        </div>
    </div>

    <partial name="_StatusMessage" />

    <div class="row">
        <div class="col-xl-8 col-xxl-constrain">

            <div class="form-group mb-4">
                <label asp-for="LightSpeedUrl" class="form-label fw-semibold">Lightspeed Domain URL</label>
                <input asp-for="LightSpeedUrl" class="form-control" placeholder="myshop" autocomplete="off" />
                @* <div class="input-group">
                    <input asp-for="LightspeedDomainPrefix" class="form-control" placeholder="myshop" autocomplete="off" />
                    <span class="input-group-text text-muted">.vendhq.com</span>
                </div> *@
                <span asp-validation-for="LightSpeedUrl" class="text-danger small"></span>
            </div>

            <div class="form-group mb-4">
                <label asp-for="Currency" class="form-label fw-semibold">Fiat Currency</label>
                <input asp-for="Currency" class="form-control" style="max-width:120px" placeholder="USD" />
                <div class="form-text">
                    Must match the currency configured in your Lightspeed register.
                </div>
            </div>

            <div class="form-group mb-4">
                <label asp-for="LightspeedPersonalAccessToken" class="form-label fw-semibold">
                    Personal Access Token
                    <span class="badge bg-secondary fw-normal ms-1">Optional</span>
                </label>
                <input asp-for="LightspeedPersonalAccessToken"
                       class="form-control"
                       type="password"
                       autocomplete="new-password"
                       placeholder="••••••••••••••••" />
                <div class="form-text">
                    Only needed to pull full sale details (line items, customer info) via
                    the Lightspeed REST API. Generate one in Lightspeed under
                    <strong>Setup → Personal Access Tokens</strong>.
                </div>
            </div>

            <div class="p-3 bg-light border rounded mb-2">
                <h6 class="fw-semibold mb-2">Register the Gateway URL in Lightspeed</h6>
                <ol class="mb-2 ps-3 small text-muted">
                    <li>Go to <strong>Setup → Payment Types</strong> in Lightspeed Retail.</li>
                    <li>Click <strong>Add Payment Type → Other</strong>.</li>
                    <li>Paste the URL below as the <strong>Gateway URL</strong>.</li>
                </ol>
                <div class="input-group input-group-sm">
                    <input type="text" class="form-control font-monospace bg-white"
                           value="@(Context.Request.Scheme)://@(Context.Request.Host)/plugins/@Model.StoreId/lightspeedhq/gateway"
                           readonly />
                    <button class="btn btn-outline-secondary" type="button"
                            onclick="navigator.clipboard.writeText(this.previousElementSibling.value).then(()=>{ this.textContent='Copied!'; setTimeout(()=>this.textContent='Copy',1500) })">
                        Copy
                    </button>
                </div>
            </div>

        </div>
    </div>
</form>
